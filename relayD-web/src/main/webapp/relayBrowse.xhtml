<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html
	xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:p="http://primefaces.org/ui"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:fn="http://java.sun.com/jsp/jstl/functions">

<h:head>
	<link
		rel="stylesheet"
		href="./styles/relayd.css"></link>
	<link
		rel="icon"
		href="http://relayd.de:8080/relayD-web/favicon.ico" />
</h:head>

<h:body>
	<h:form id="form">

		<p:growl
			id="messages"
			showDetail="true" />

		<p:layout fullPage="true">

			<p:layoutUnit
				position="north"
				resizable="false"
				size="166">
				<div class="divStartHeader"></div>
			</p:layoutUnit>

			<p:layoutUnit
				position="west"
				resizable="false"
				size="45%">
				<p:toolbar>
					<f:facet name="left">
						<p:commandButton
							actionListener="#{relayBrowsePageBean.showAllRelays}"
							icon="ui-icon-arrowrefresh-1-w"
							update="relayTable">
						</p:commandButton>
						<p:commandButton
							update="relayTable"
							icon="ui-icon-plus"
							actionListener="#{relayBrowsePageBean.addRelay}">
							<p:ajax
								event="dialogReturn"
								update="relayTable"
								listener="#{relayBrowsePageBean.onRelayEditClosed}" />
						</p:commandButton>
						<p:commandButton
							icon="ui-icon-pencil"
							actionListener="#{relayBrowsePageBean.editRelay}">
							<p:ajax
								event="dialogReturn"
								update="relayTable"
								listener="#{relayBrowsePageBean.onRelayEditClosed}" />
						</p:commandButton>
						<p:commandButton
							value="export"
							icon="ui-icon-mail-closed"
							update="messages"
							actionListener="#{relayBrowsePageBean.emailExportRelay}" />
					</f:facet>
					<f:facet name="right">
						<p:commandButton
							actionListener="#{relayBrowsePageBean.openAllRelays}"
							update="relayTable"
							icon="ui-icon-zoomin">
						</p:commandButton>
						<p:commandButton
							actionListener="#{relayBrowsePageBean.closeAllRelays}"
							update="relayTable"
							icon="ui-icon-zoomout">
						</p:commandButton>
					</f:facet>
				</p:toolbar>
				<p:treeTable
					id="relayTable"
					selection="#{relayBrowsePageBean.selectedNode}"
					selectionMode="single"
					scrollable="true"
					scrollHeight="92%"
					value="#{relayBrowsePageBean.root}"
					var="relayRow">
					<f:facet name="header">
		            Relays
		        	</f:facet>
					<p:column headerText="Name">
						<h:outputText value="#{relayRow.relayname}" />
					</p:column>
					<p:column headerText="Duration">
						<h:outputText value="#{relayRow.duration}" />
					</p:column>
					<p:column headerText="Participant">
						<h:outputText value="#{relayRow.participant}" />
						<div align="right">
							<h:outputText styleClass="#{relayRow.status}" />
						</div>
					</p:column>
				</p:treeTable>

			</p:layoutUnit>

			<p:layoutUnit
				position="center"
				size="5%">

				<p:commandButton
					value="add"
					style="width:95%"
					update="relayTable personTable messages"
					icon="ui-icon-circle-triangle-w"
					actionListener="#{relayBrowsePageBean.addPersonToRelay}">
				</p:commandButton>

				<p:commandButton
					value="remove"
					style="width:95%"
					update="relayTable personTable messages"
					icon="ui-icon-circle-triangle-e"
					actionListener="#{relayBrowsePageBean.removePersonFromRelay}">
				</p:commandButton>

			</p:layoutUnit>

			<p:layoutUnit
				position="east"
				size="45%">

				<p:toolbar>
					<f:facet name="right">
						<p:commandButton
							actionListener="#{relayBrowsePageBean.showAllPersons}"
							icon="ui-icon-arrowrefresh-1-w"
							update="personTable">
						</p:commandButton>
						<p:commandButton
							icon="ui-icon-plus"
							actionListener="#{relayBrowsePageBean.addPerson}">
							<p:ajax
								event="dialogReturn"
								listener="#{relayBrowsePageBean.onPersonEditClosed}"
								update="personTable" />
						</p:commandButton>
						<p:commandButton
							icon="ui-icon-trash"
							update="personTable messages"
							actionListener="#{relayBrowsePageBean.removePerson}" />
						<p:commandButton
							icon="ui-icon-pencil"
							update="messages"
							actionListener="#{relayBrowsePageBean.editPerson}">
							<p:ajax
								event="dialogReturn"
								update="personTable"
								listener="#{relayBrowsePageBean.onPersonEditClosed}" />
						</p:commandButton>
						<p:commandButton
							value="export"
							icon="ui-icon-mail-closed"
							update="personTable messages"
							actionListener="#{relayBrowsePageBean.emailExportPerson}" />
						<p:menuButton value="Filter">
							<p:menuitem
								value="All"
								update="personTable"
								icon="ui-icon-disk"
								actionListener="#{relayBrowsePageBean.showAll}" />
							<p:separator />
							<p:menuitem
								value="All without relay"
								update="personTable messages"
								icon="ui-icon-person"
								actionListener="#{relayBrowsePageBean.showAllWithoutRelay}" />
						</p:menuButton>
					</f:facet>
				</p:toolbar>

				<p:dataTable
					id="personTable"
					var="person"
					widgetVar="personTable"
					filteredValue="#{relayBrowsePageBean.filteredPersons}"
					selectionMode="multiple"
					value="#{relayBrowsePageBean.persons}"
					selection="#{relayBrowsePageBean.selectedPersons}"
					scrollable="true"
					scrollHeight="92%"
					sortBy="#{person.surename.toString()}"
					rowKey="#{person.uuid}"
					resizableColumns="true">
					<f:facet name="header">
			     		List of Persons
					</f:facet>

					<p:column
						visible="true"
						toggleable="false"
						width="2%">
						<p:rowToggler />
					</p:column>
					
					<p:column
						visible="true"
						toggleable="false"
						width="2%">
						<div align="right">
							<h:outputText styleClass="#{relayBrowsePageBean.statusOf(person)}" />
						</div>
					</p:column>
					
					<p:column
						visible="true"
						toggleable="false"
						width="2%">
						<div align="left">
							<h:outputText value="#{relayBrowsePageBean.relayCountOf(person)}"/>
						</div>
					</p:column>

					<p:column
						headerText="Forename"
						sortBy="#{person.forename}"
						sortFunction="#{relayBrowsePageBean.sortByForename}"
						width="18%">
						<h:outputText value="#{person.forename}" />
					</p:column>

					<p:column
						headerText="Surename"
						filterMatchMode="contains"
						sortBy="#{person.surename}"
						sortFunction="#{relayBrowsePageBean.sortBySurename}"
						width="23%">
						<h:outputText value="#{person.surename}" />
					</p:column>

					<p:column
						headerText="Comment"
						width="53%">
						<h:outputText value="#{person.comment}" />
					</p:column>

					<p:rowExpansion>
						<p:panelGrid
							columns="2"
							columnClasses="label,value">

							<h:outputText value="Year of Birth" />
							<h:outputText value="#{person.yearOfBirth}" />

							<h:outputText value="Shirtsize" />
							<h:outputText value="#{person.shirtsize.toString()}" />

							<h:outputText value="Email" />
							<h:outputText value="#{person.email}" />
						</p:panelGrid>
					</p:rowExpansion>

				</p:dataTable>
			</p:layoutUnit>

			<p:layoutUnit
				position="south"
				resizable="false"
				size="52">
			</p:layoutUnit>

		</p:layout>

		<ui:include src="/dock.xhtml" />

	</h:form>
</h:body>
</html>